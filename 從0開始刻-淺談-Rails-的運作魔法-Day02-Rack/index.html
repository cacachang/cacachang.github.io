<!DOCTYPE html><html lang="zh-TW"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title>å¾0é–‹å§‹åˆ» æ·ºè«‡ Rails çš„é‹ä½œé­”æ³• Day02 - Rack Â· NingLab</title><meta name="description" content="Rackæ˜¯ä»€éº¼ï¼ŸRack å°±åƒ Ruby èˆ‡ Web Browser ä¹‹é–“çš„æºé€šæ©‹æ¨‘ä½¿ç”¨ç°¡å–®çš„æ–¹æ³•ä¾†å‚³é HTTP requestHTTP æ”¶åˆ° request å¾Œæœƒå‚³å›æ‡‰çµ¦æˆ‘å€‘
Rack æœ‰å›ºå®šçš„è¦æ ¼ï¼Œå®ƒéœ€è¦æœ‰å€‹å¯ä»¥å›æ‡‰ call æ–¹æ³•çš„ç‰©ä»¶
ä»¥ä¸‹ Ruby ç¨‹å¼ç¢¼ä¾†èªªcall çš„åƒæ•¸æ˜¯ä¸€å€‹ ha"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.jpeg" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 7.1.1"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/ning.jpg" style="width:200px;"><h3 title=""><a href="/">NingLab</a></h3></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://twitter.com/ningchang_"><i class="fa fa-twitter"></i></a></li><li><a target="_blank" rel="noopener" href="https://github.com/cacachang"><i class="fa fa-github"></i></a></li><li><a href="mailto:a24701770@gmail.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.instagram.com/web543_/"><i class="fa fa-instagram"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/%E7%8F%88%E5%AF%A7-%E5%BC%B5-140a86125/"><i class="fa fa-linkedin"></i></a></li></ul><div class="footer"><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">é¦–é </a></li><li><a href="/archives">æ–‡ç« </a></li><li><a href="/categories">ç›®éŒ„</a></li><li><a href="/about">é—œæ–¼ Ning</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.jpeg"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>å¾0é–‹å§‹åˆ» æ·ºè«‡ Rails çš„é‹ä½œé­”æ³• Day02 - Rack</a></h3></div><div class="post-content"><h2 id="Rackæ˜¯ä»€éº¼ï¼Ÿ"><a href="#Rackæ˜¯ä»€éº¼ï¼Ÿ" class="headerlink" title="Rackæ˜¯ä»€éº¼ï¼Ÿ"></a>Rackæ˜¯ä»€éº¼ï¼Ÿ</h2><p>Rack å°±åƒ Ruby èˆ‡ Web Browser ä¹‹é–“çš„æºé€šæ©‹æ¨‘<br>ä½¿ç”¨ç°¡å–®çš„æ–¹æ³•ä¾†å‚³é HTTP request<br>HTTP æ”¶åˆ° request å¾Œæœƒå‚³å›æ‡‰çµ¦æˆ‘å€‘</p>
<p>Rack æœ‰å›ºå®šçš„è¦æ ¼ï¼Œå®ƒéœ€è¦æœ‰å€‹å¯ä»¥å›æ‡‰ call æ–¹æ³•çš„ç‰©ä»¶</p>
<p>ä»¥ä¸‹ Ruby ç¨‹å¼ç¢¼ä¾†èªª<br>call çš„åƒæ•¸æ˜¯ä¸€å€‹ hash<br>é€™å€‹ hash åŒ…å«äº† CGI-like ç’°å¢ƒçš„è®Šæ•¸<br>å›å‚³ç‚ºé™£åˆ—ï¼Œåˆ†åˆ¥ç‚º HTTP ç‹€æ…‹ã€HTTP headerã€Body</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">call</span>(<span class="params">env</span>)</span><br><span class="line">      [</span><br><span class="line">        <span class="number">200</span>, </span><br><span class="line">        &#123;<span class="string">&#x27;Content-Type&#x27;</span> =&gt; <span class="string">&#x27;text/html&#x27;</span>&#125;,</span><br><span class="line">        [<span class="string">&quot;Hello from Ruby on Rulers!&quot;</span>]</span><br><span class="line">      ]</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">run <span class="title class_">Application</span>.new</span><br></pre></td></tr></table></figure>

<p>ç•¶æˆ‘å€‘è·‘ Rack æ™‚ï¼Œæœƒå•Ÿç”¨ä¸€å€‹å«åš WEBrick çš„ä¼ºæœå™¨<br>çœ‹åˆ°ä¸‹åˆ—è¨Šæ¯å°±å¯ä»¥é€²å…¥ <a target="_blank" rel="noopener" href="http://localhost:9292/">http://localhost:9292/</a> ä¼ºæœå™¨å›‰ï¼<br>(ä¹‹å¾Œæ‰‹åˆ»ä¹Ÿæœƒçœ‹åˆ°å®ƒ)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[2022-08-16 02:08:12] INFO  WEBrick 1.6.0</span><br><span class="line">[2022-08-16 02:08:12] INFO  ruby 2.7.2 (2020-10-01) [arm64-darwin20]</span><br><span class="line">[2022-08-16 02:08:12] INFO  WEBrick::HTTPServer#start: pid=45085 port=9292</span><br></pre></td></tr></table></figure>

<p>çœ‹çœ‹æµç¨‹åœ–åŠ é€Ÿç†è§£ğŸ‘‡</p>
<p><img src="https://i.imgur.com/ZyYTeDl.jpg"></p>
</br>

<p>ğŸ“ƒ web å°è¾­å…¸</p>
<p>â–¶  CGI: æ˜¯ä¸€ç¨®æ¨™æº–ä»‹é¢ç¨‹å¼ï¼Œè®“ç¶²é è·Ÿ www server æºé€šï¼Œè®“ä½¿ç”¨è€…èƒ½è·Ÿç¶²é äº’å‹•</p>
<p>â–¶  WEBrickï¼šå±¬æ–¼ Ruby libraryï¼Œæä¾›ç°¡å–®çš„ HTTP server</p>
</br>


<h2 id="Rack-åœ¨-Rails-ä¸­çš„è§’è‰²"><a href="#Rack-åœ¨-Rails-ä¸­çš„è§’è‰²" class="headerlink" title="Rack åœ¨ Rails ä¸­çš„è§’è‰²"></a>Rack åœ¨ Rails ä¸­çš„è§’è‰²</h2><p>Rack æ˜¯ä¸€ç¨® Middlewareï¼Œæ˜¯æ¡†æ¶èˆ‡ä¼ºæœå™¨ä¹‹é–“çš„ API<br>Rails.application æ˜¯å±¬æ–¼ Rack æ‡‰ç”¨ç¨‹å¼ç‰©ä»¶<br>èˆ‡ Rack ç›¸å®¹çš„ web server éƒ½æ‡‰è©²è¦æ¡ç”¨ Rails.application ä¾†é‹ä½œã€åŸ·è¡Œ</p>
<h3 id="rails-server"><a href="#rails-server" class="headerlink" title="rails server"></a>rails server</h3><p>Rails::Server ç¹¼æ‰¿ Rack::Serverç‰¹æ€§<br>å¯ä»¥ç”¨ä¾†å•Ÿå‹• web server</p>
<p>ç•¶æˆ‘å€‘è¼¸å…¥ rails server æ™‚<br>æœƒå»ºç«‹ Rack::Server ç‰©ä»¶<br>ä¸¦ä¸”é–‹å•Ÿ server</p>
<h3 id="rackup"><a href="#rackup" class="headerlink" title="rackup"></a>rackup</h3><p>å¦‚æœä¸æƒ³ç”¨ rails server å•Ÿå‹•ä¼ºæœå™¨<br>å¯æ”¹ç”¨ rackup<br>ä¸éä½ å¾—å…ˆæœ‰ config.ru çš„è¨­å®šæª”(.ru å°±æ˜¯ rackup çš„ç¸®å¯«)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é–‹å•Ÿ server</span></span><br><span class="line">rackup config.ru </span><br></pre></td></tr></table></figure>

<h4 id="Rack-ä¸¦ä¸æ˜¯åªæ‹¿ä¾†å•Ÿå‹•ä¼ºæœå™¨"><a href="#Rack-ä¸¦ä¸æ˜¯åªæ‹¿ä¾†å•Ÿå‹•ä¼ºæœå™¨" class="headerlink" title="Rack ä¸¦ä¸æ˜¯åªæ‹¿ä¾†å•Ÿå‹•ä¼ºæœå™¨"></a>Rack ä¸¦ä¸æ˜¯åªæ‹¿ä¾†å•Ÿå‹•ä¼ºæœå™¨</h4><p>Rack é€™éº¼å²å®³ï¼Œæ€éº¼å¯èƒ½åªæœƒå•Ÿå‹•ä¼ºæœå™¨<br>Rails ä¸­è¨±å¤šæ‡‰ç”¨ç¨‹å¼éƒ½æ˜¯ä½¿ç”¨ Rack Middleware ä¾†æ“ä½œ</p>
<p>ä¸éé€™äº›æ‡‰ç”¨ç¨‹å¼é‹ä½œçš„å°è±¡ä¹Ÿéƒ½è·Ÿç€è¦½å™¨è„«é›¢ä¸äº†é—œä¿‚</p>
<p>é€™é‚Šä¾†æå¹¾å€‹æ‡‰ç”¨ç¨‹å¼</p>
<p>Rack::Sendfile ğŸ‘‰ ç”¨æ¨™æº–åŒ–çš„è³‡æ–™æ ¼å¼(<a target="_blank" rel="noopener" href="https://www.nginx.com/resources/wiki/start/topics/examples/xsendfile/">X-Sendfile</a>)è¨­å®š Header</p>
<p>Rack::Lock ğŸ‘‰ è¨­å®šæ‡‰ç”¨ç¨‹å¼æ˜¯å¦å¯ä»¥å¤šå·¥ä½œæ¥­(<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-tw/%E4%BA%92%E6%96%A5%E9%94%81">Mutex</a>)</p>
<p>Rack::MethodOverride ğŸ‘‰ æœ‰è¨­å®š params[:_method]ï¼Œå°±å¯ä»¥é‡æ–°è¨­å®šæ–¹æ³•</p>
<p>å…¶ä»–æ‡‰ç”¨ç¨‹å¼è©³ç´°è³‡æ–™å¯ä»¥åƒç…§ <a target="_blank" rel="noopener" href="https://guides.rubyonrails.org/rails_on_rack.html">Rails å®˜æ–¹ç¶²ç«™</a></p>
<h2 id="Rack-Middleware-é‹ä½œ"><a href="#Rack-Middleware-é‹ä½œ" class="headerlink" title="Rack Middleware é‹ä½œ"></a>Rack Middleware é‹ä½œ</h2><p>æ¡ç”¨ pipeline æ–¹å¼(ç®¡ç·šåŒ–)<br>ç”¨é€™ç¨®æ–¹å¼é‹ä½œæœƒè®“æ•ˆç‡å¤§å¹…æå‡<br>è®“æˆ‘å€‘ä¾†çœ‹ä¸€ä¸‹ä»–çš„é‹ä½œæµç¨‹</p>
<p><img src="https://i.imgur.com/LbGVuOM.jpg"></p>
<p>Rack æœƒä¾ç…§ä¸åŒé¡å‹è«‹æ±‚ä¾†å€åˆ†<br>åŸ·è¡Œé †åº1ï¼šèªè­‰çš„è®€å–æŒ‡ä»¤é–‹å§‹åŸ·è¡Œ<br>åŸ·è¡Œé †åº2ï¼šèªè­‰çš„æŒ‡ä»¤è§£ç¢¼åŠè®€å–æš«å­˜ã€æˆæ¬Šçš„è®€å–æŒ‡ä»¤æœƒä¸€èµ·é€²è¡Œ<br>â‹¯â‹¯ä¾æ­¤é¡æ¨</p>
<p>ğŸ“Œ ç”Ÿæ´»å°ä¾‹å­</p>
<p>ä»¥é¸èˆ‰æµç¨‹ä¾†èªª<br>ç•¶Aé–‹å§‹é€²å…¥æŠ•ç¥¨æµç¨‹æ™‚ï¼Œå…¶ä»–äººçš„å€‹åˆ¥é€²åº¦ä¹Ÿå¯ä»¥åŒæ™‚è¢«æ¨é€²<br>æ¸›å°‘ç­‰å¾…æ™‚é–“ã€æå‡æ•ˆç‡</p>
<p><img src="https://i.imgur.com/2NCyqsQ.jpg"></p>
<h2 id="Rakeã€Rack-å‚»å‚»åˆ†ä¸æ¸…"><a href="#Rakeã€Rack-å‚»å‚»åˆ†ä¸æ¸…" class="headerlink" title="Rakeã€Rack å‚»å‚»åˆ†ä¸æ¸…"></a>Rakeã€Rack å‚»å‚»åˆ†ä¸æ¸…</h2><p>ä»–å€‘ç°¡ç›´å°±æ˜¯é›™èƒèƒ<br>ç¨ä¸€ä¸ç•™ç¥å°±èªéŒ¯äº†å•Š</p>
<p>Rack æ˜¯ä¸€ç¨® Middlewareï¼Œä¸»è¦è² è²¬è™•ç†è·Ÿ HTTP request æœ‰é—œçš„ä»»å‹™<br>Rake æ˜¯ Rails ä¸­çš„ task åŸ·è¡Œè€…ï¼Œè®€å– Rakefile æœƒé–‹å§‹åŸ·è¡Œ task</p>
<p>é‡åˆ°é€™å…©å…„å¼Ÿè¦è¨˜å¾—æ‹¿æ”¾å¤§é¡çœ‹æ¸…æ¥šğŸ§<br>ä»Šå¤©å°±å…ˆä»‹ç´¹åˆ°é€™é‚Šå“© ğŸ˜‰</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-08-16</span><i class="fa fa-tag"></i><a class="tag" href="/categories/Rebuild-Rails/" title="Rebuild Rails">Rebuild Rails </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,http://ninglab.com/å¾0é–‹å§‹åˆ»-æ·ºè«‡-Rails-çš„é‹ä½œé­”æ³•-Day02-Rack/,NingLab,å¾0é–‹å§‹åˆ» æ·ºè«‡ Rails çš„é‹ä½œé­”æ³• Day02 - Rack,;"></a></div></div><div><script src="https://utteranc.es/client.js" repo="cacachang/cacachang.github.io" issue-term="title" theme="github-light" crossorigin="anonymous" async></script></div><div><script type="text/javascript">document.write("<iframe scrolling='no' frameborder='0' sandbox='allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation' style='height: 212px; width: 100%;' src='https://button.like.co/in/embed/a24701770/button?referrer=" + encodeURIComponent(location.href.split("?")[0].split("#")[0]) + "'></iframe>");</script></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/%E5%BE%9E0%E9%96%8B%E5%A7%8B%E5%88%BB-%E6%B7%BA%E8%AB%87-Rails-%E7%9A%84%E9%81%8B%E4%BD%9C%E9%AD%94%E6%B3%95-Day03-GEM/" title="å¾0é–‹å§‹åˆ» æ·ºè«‡ Rails çš„é‹ä½œé­”æ³• - Day03 GEM">ä¸Šä¸€ç¯‡</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/%E5%BE%9E0%E9%96%8B%E5%A7%8B%E5%88%BB-%E6%B7%BA%E8%AB%87-Rails-%E7%9A%84%E9%81%8B%E4%BD%9C%E9%AD%94%E6%B3%95-Day01-RMVC%E6%9E%B6%E6%A7%8B%E4%B9%8B%E7%82%BA%E4%BB%80%E9%BA%BC%E8%A6%81%E5%AE%89%E8%A3%9Dnode-js/" title="å¾0é–‹å§‹åˆ» æ·ºè«‡ Rails çš„é‹ä½œé­”æ³• Day01 RMVCæ¶æ§‹ä¹‹ç‚ºä»€éº¼è¦å®‰è£node.js">ä¸‹ä¸€ç¯‡</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>