<!DOCTYPE html><html lang="zh-TW"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title>幫網頁施點魔法 - JavaScript this · NingLab</title><meta name="description" content="this到底是哪個this？傻傻分不清楚相信大家對於this又愛又恨好用的時候超好用失控的時候很失控
今天就來帶大家認識一下該怎麼判斷現在的this指的是誰
廢話不多說，直接進入主題！

先讓大家了解一下環境的差異node.js的環境叫做 global瀏覽器的環境叫做 window
在這兩個環境中t"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><script async src="https://www.googletagmanager.com/gtag/js?id=G-4P2R013PGL"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-4P2R013PGL')
</script><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.jpeg" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 7.1.1"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/ning.jpg" style="width:200px;"><h3 title=""><a href="/">NingLab</a></h3></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://twitter.com/ningchang_"><i class="fa fa-twitter"></i></a></li><li><a target="_blank" rel="noopener" href="https://github.com/cacachang"><i class="fa fa-github"></i></a></li><li><a href="mailto:a24701770@gmail.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.instagram.com/web543_/"><i class="fa fa-instagram"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/cacachang/"><i class="fa fa-linkedin"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.youtube.com/channel/UCwRiNPzYITZWaif23HTmHZQ"><i class="fa fa-youtube"></i></a></li></ul><div class="footer"><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首頁</a></li><li><a href="/archives">文章</a></li><li><a href="/categories">目錄</a></li><li><a href="/about">關於 Ning</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.jpeg"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>幫網頁施點魔法 - JavaScript this</a></h3></div><div class="post-content"><h2 id="this到底是哪個this？傻傻分不清楚"><a href="#this到底是哪個this？傻傻分不清楚" class="headerlink" title="this到底是哪個this？傻傻分不清楚"></a>this到底是哪個this？傻傻分不清楚</h2><p>相信大家對於this又愛又恨<br>好用的時候超好用<br>失控的時候很失控</p>
<p>今天就來帶大家認識一下該怎麼判斷<br>現在的this指的是誰</p>
<p>廢話不多說，直接進入主題！</p>
<hr>
<h2 id="先讓大家了解一下環境的差異"><a href="#先讓大家了解一下環境的差異" class="headerlink" title="先讓大家了解一下環境的差異"></a>先讓大家了解一下環境的差異</h2><p>node.js的環境叫做 global<br>瀏覽器的環境叫做 window</p>
<p>在這兩個環境中<br>this會依環境的不同，而指向不一樣的地方(沒設定嚴謹模式)<br>但其實指向這兩個地方，都是所謂的全域範圍</p>
<p>如果設定嚴謹模式，this則會指向undefined</p>
<h2 id="存在物件中的-this"><a href="#存在物件中的-this" class="headerlink" title="存在物件中的 this"></a>存在物件中的 this</h2><p>this存在物件中才會發揮它的效用<br>一旦離開了物件<br>this會被賦予預設的值，也就是 window &#x2F; global</p>
<hr>
<h3 id="1-誰呼叫，誰就是this"><a href="#1-誰呼叫，誰就是this" class="headerlink" title="1. 誰呼叫，誰就是this"></a>1. 誰呼叫，誰就是this</h3><h4 id="沒明確的呼叫者，this就是window-global"><a href="#沒明確的呼叫者，this就是window-global" class="headerlink" title="沒明確的呼叫者，this就是window&#x2F;global"></a>沒明確的呼叫者，this就是window&#x2F;global</h4><p>owner為呼叫者，所以this會指向owner<br>在owner中尋找ability並印出來</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> owner = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Nick&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">ability</span>: <span class="string">&quot;baking&quot;</span>,</span><br><span class="line">  <span class="attr">skill</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">ability</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">owner.<span class="title function_">skill</span>() <span class="comment">// baking</span></span><br></pre></td></tr></table></figure>

<p>沒有明確呼叫者，就等於是window呼叫function<br>於是this就會指向 window &#x2F; global</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sleep</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> bedtime = <span class="number">12</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">bedtime</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sleep</span>() <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>

<br/>


<h3 id="2-箭頭函式的-this-不會指向自己"><a href="#2-箭頭函式的-this-不會指向自己" class="headerlink" title="2. 箭頭函式的 this 不會指向自己"></a>2. 箭頭函式的 this 不會指向自己</h3><h4 id="指向-window-global"><a href="#指向-window-global" class="headerlink" title="指向 window &#x2F; global"></a>指向 window &#x2F; global</h4><p>箭頭函示中的this會強制綁定<br>儘管今天使用嚴謹模式、apply()等方法綁定<br>this仍然指向預設的全域</p>
<p>以下面這個範例來看<br>在箭頭函式裡面定義了變數<br>裡面的this還是會往外指向 window &#x2F; global<br>並且尋找 window &#x2F; global 中的變數(num1、num2)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num1 = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> num2 = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="title function_">numberCalculator</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> num1 = <span class="number">3</span></span><br><span class="line">  <span class="keyword">let</span> num2 = <span class="number">4</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">num1</span> + <span class="variable language_">this</span>.<span class="property">num2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">numberCalculator</span>() <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<br/>


<h3 id="3-有沒有使用-new"><a href="#3-有沒有使用-new" class="headerlink" title="3. 有沒有使用 new"></a>3. 有沒有使用 new</h3><p>如果使用new來產生新的物件，this就會指向空物件，<br>而這個空物件的__proto__會引領指向父層的prototype，<br>this就會指向父層的參數</p>
<p>這樣講有點難以理解，讓我們來點範例！<br>this會依__proto__指向父層(function)的name以及variety<br>this就會指向name及variety這兩個的值</p>
<p>神奇的是，用new產生的物件<br>不需要特別寫return，就會直接把this回傳過去！</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cat = <span class="keyword">new</span> <span class="keyword">function</span> (<span class="params">name, variety</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;kitty&quot;</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">variety</span> = <span class="string">&quot;yellow&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">cat <span class="comment">// &#123;name: &#x27;kitty&#x27;, variety: &#x27;yellow&#x27;&#125;</span></span><br></pre></td></tr></table></figure>


<br/>


<h3 id="4-有沒有使用apply-、call-、bind"><a href="#4-有沒有使用apply-、call-、bind" class="headerlink" title="4. 有沒有使用apply()、call()、bind()"></a>4. 有沒有使用apply()、call()、bind()</h3><p>使用上面三個方法時，this會指向這三個方法的參數，而不是物件的參數<br>其中apply()以及bind()會有限制用法</p>
<p>從下面例子來看，studentA、studentB為apply()及call()的參數，而非function的參數</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> teacher = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Ray&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">45</span>,</span><br><span class="line">  <span class="attr">ability</span>: <span class="string">&quot;reading &quot;</span>,</span><br><span class="line">  <span class="attr">skill</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">ability</span> += <span class="string">&quot;&amp; conversation&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> studentA = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Ray&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">25</span>,</span><br><span class="line">  <span class="attr">ability</span>: <span class="string">&quot;listening &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> studentB = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Any&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="attr">ability</span>: <span class="string">&quot;writing &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 老師今天學習了會話，然後要教給學生</span></span><br><span class="line">teacher.<span class="title function_">skill</span>() <span class="comment">// reading &amp; conversation</span></span><br><span class="line">teacher.<span class="property">skill</span>.<span class="title function_">apply</span>(studentA) <span class="comment">// listening &amp; conversation</span></span><br><span class="line">teacher.<span class="property">skill</span>.<span class="title function_">call</span>(studentB) <span class="comment">// writing &amp; conversation</span></span><br></pre></td></tr></table></figure>

<p>而bind比較特別，會回傳一個function，所以要記得呼叫它</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> teacher = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Ray&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">45</span>,</span><br><span class="line">  <span class="attr">ability</span>: <span class="string">&quot;reading &quot;</span>,</span><br><span class="line">  <span class="attr">skill</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">ability</span> += <span class="string">&quot;&amp; conversation&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> studentA = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Ray&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">45</span>,</span><br><span class="line">  <span class="attr">ability</span>: <span class="string">&quot;listening &quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">teacher.<span class="property">skill</span>.<span class="title function_">bind</span>(studentA)() <span class="comment">// listening &amp; conversation</span></span><br></pre></td></tr></table></figure>

<p>如果要在apple()、call()後面加上function的參數，需要寫在第二個位置<br>其中apply()需要使用陣列的方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> num = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;number&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span> (a, b)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.type&#125;</span> = <span class="subst">$&#123;a&#125;</span> + <span class="subst">$&#123;b&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add.<span class="title function_">apply</span>(num, [<span class="number">3</span>, <span class="number">4</span>]) <span class="comment">// number = 3 + 4</span></span><br><span class="line">add.<span class="title function_">call</span>(num, <span class="number">3</span>, <span class="number">4</span>) <span class="comment">// number = 3 + 4</span></span><br></pre></td></tr></table></figure>

<br/>


<h3 id="5-是否使用嚴謹模式"><a href="#5-是否使用嚴謹模式" class="headerlink" title="5. 是否使用嚴謹模式"></a>5. 是否使用嚴謹模式</h3><p>嚴謹模式是ES6新增的功能<br>只要標注”use_strict”<br>this就不會隨便指向 window &#x2F; global</p>
<p>也可以針對單一物件做設定</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">receipt</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&quot;use strict&quot;</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">receipt</span>() <span class="comment">// undefined</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="this綁定原則"><a href="#this綁定原則" class="headerlink" title="this綁定原則"></a>this綁定原則</h2><p>依照上述五種狀況做個總結，this可分為幾個綁定原則</p>
<ol>
<li><p>預設綁定(default binding)<br>  依照環境指向不一樣的地方<br> ▶ 嚴謹模式指向undefined<br> ▶ 沒有呼叫者的情況，會指向預設的全域(window &#x2F; global)</p>
</li>
<li><p>隱含式綁定(implicit binding)<br>  即便是在全域範圍，有明確呼叫者的情況，this就會指向呼叫者，而非全域</p>
</li>
<li><p>顯式綁定(explicit binding)<br>  透過apply()、call()、bind()直接綁定this的值</p>
</li>
<li><p>new 綁定<br>  new出來的物件，this會指向父層的參數</p>
</li>
</ol>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-08-13</span><i class="fa fa-tag"></i><a class="tag" href="/categories/JavaScript/" title="JavaScript">JavaScript </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,http://ninglab.com/JavaScript-this/,NingLab,幫網頁施點魔法 - JavaScript this,;"></a></div></div><div><script src="https://utteranc.es/client.js" repo="cacachang/cacachang.github.io" issue-term="title" theme="github-light" crossorigin="anonymous" async></script></div><div><script type="text/javascript">document.write("<iframe scrolling='no' frameborder='0' sandbox='allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation' style='height: 212px; width: 100%;' src='https://button.like.co/in/embed/a24701770/button?referrer=" + encodeURIComponent(location.href.split("?")[0].split("#")[0]) + "'></iframe>");</script></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/%E5%BE%9E0%E9%96%8B%E5%A7%8B%E5%88%BB-%E6%B7%BA%E8%AB%87-Rails-%E7%9A%84%E9%81%8B%E4%BD%9C%E9%AD%94%E6%B3%95-Day01-RMVC%E6%9E%B6%E6%A7%8B%E4%B9%8B%E7%82%BA%E4%BB%80%E9%BA%BC%E8%A6%81%E5%AE%89%E8%A3%9Dnode-js/" title="從0開始刻 淺談 Rails 的運作魔法 Day01 RMVC架構之為什麼要安裝node.js">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/JavaScript-variable-hoisting/" title="幫網頁施點魔法 - JavaScript 變數提升解密">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>