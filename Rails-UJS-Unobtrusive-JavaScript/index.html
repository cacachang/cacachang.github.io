<!DOCTYPE html><html lang="zh-TW"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author"><title>小機制大效用 一用就回不去的 Rails UJS - Unobtrusive JavaScript · NingLab</title><meta name="description" content="小機制大效用 一用就回不去的 Rails UJS - Unobtrusive JavaScript真正認識UJS後，就會發現他是個超好用的東西讓程式碼更簡潔，也能少寫一些程式碼
JQuery UJS咦，不是說要介紹Rails UJS嗎？為什麼會出現一個毫無相關的JQuery呢？
其實在Rails 5"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><script async src="https://www.googletagmanager.com/gtag/js?id=G-4P2R013PGL"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-4P2R013PGL')
</script><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.jpeg" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 7.1.1"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/ning.jpg" style="width:200px;"><h3 title=""><a href="/">NingLab</a></h3></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://twitter.com/ningchang_"><i class="fa fa-twitter"></i></a></li><li><a target="_blank" rel="noopener" href="https://github.com/cacachang"><i class="fa fa-github"></i></a></li><li><a href="mailto:a24701770@gmail.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.instagram.com/web543_/"><i class="fa fa-instagram"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/cacachang/"><i class="fa fa-linkedin"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.youtube.com/channel/UCwRiNPzYITZWaif23HTmHZQ"><i class="fa fa-youtube"></i></a></li></ul><div class="footer"><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首頁</a></li><li><a href="/archives">文章</a></li><li><a href="/categories">目錄</a></li><li><a href="/about">關於 Ning</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.jpeg"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>小機制大效用 一用就回不去的 Rails UJS - Unobtrusive JavaScript</a></h3></div><div class="post-content"><h1 id="小機制大效用-一用就回不去的-Rails-UJS-Unobtrusive-JavaScript"><a href="#小機制大效用-一用就回不去的-Rails-UJS-Unobtrusive-JavaScript" class="headerlink" title="小機制大效用 一用就回不去的 Rails UJS - Unobtrusive JavaScript"></a>小機制大效用 一用就回不去的 Rails UJS - Unobtrusive JavaScript</h1><p>真正認識UJS後，就會發現他是個超好用的東西<br>讓程式碼更簡潔，也能<del>少寫一些程式碼</del></p>
<h3 id="JQuery-UJS"><a href="#JQuery-UJS" class="headerlink" title="JQuery UJS"></a>JQuery UJS</h3><p>咦，不是說要介紹Rails UJS嗎？<br>為什麼會出現一個毫無相關的JQuery呢？</p>
<p>其實在Rails 5以前<br>Rails就有包含JQuery UJS</p>
<p>寫Rails時可以更輕鬆的發送AJAX Request<br>有時候甚至不用撰寫<br>他自動就會幫你送出</p>
<p>不過Rails 5之後，Rails就把JQuery拔掉了<br>改換內建的 Rails UJS</p>
<p>應該是太好用才這樣設計吧 (笑</p>
<h3 id="本次主角-Rails-UJS"><a href="#本次主角-Rails-UJS" class="headerlink" title="本次主角 - Rails UJS"></a>本次主角 - Rails UJS</h3><p>Rails UJS會幫我們做幾件事情</p>
<ol>
<li>在表單、連結物件上，自動加入data-*屬性</li>
<li>轉換GET為其他方法，讓Rails執行</li>
<li>data confirm防呆確認</li>
<li>防止雙點擊</li>
</ol>
<h3 id="1-在表單、連結物件上，加入data-屬性"><a href="#1-在表單、連結物件上，加入data-屬性" class="headerlink" title="1. 在表單、連結物件上，加入data-*屬性"></a>1. 在表單、連結物件上，加入data-*屬性</h3><p>來看看哪些特殊的物件會被加入屬性吧～</p>
<h4 id="form-helper"><a href="#form-helper" class="headerlink" title="form helper"></a>form helper</h4><p>神奇的表單工具，會猜測你的路徑以及表單要做的事</p>
<p>當我們使用form_for、form_tag、form_with來產生表單時<br>Rails UJS會生出一個隱藏表單<br>在裡面加入屬性，像是方法，並帶token去發送請求</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我們使用form_for來做表單</span></span><br><span class="line">&lt;%= form_for <span class="variable">@article</span> <span class="keyword">do</span> |<span class="params">form</span>| %&gt;</span><br><span class="line">  標題：</span><br><span class="line">  &lt;%= form.text_field <span class="symbol">:title</span> %&gt;</span><br><span class="line">  內容：</span><br><span class="line">  &lt;%= form.text_field <span class="symbol">:content</span> %&gt;</span><br><span class="line">  &lt;%= form.submit <span class="string">&#x27;送出&#x27;</span> %&gt;</span><br><span class="line">&lt;% <span class="keyword">end</span> %&gt;</span><br></pre></td></tr></table></figure>

<p>HTML原始碼</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Rails UJS 生出來的隱藏欄位 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;patch&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Form生出來的，Rails UJS 會一起打包帶走 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;authenticity_token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;xxxxx&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="link-to"><a href="#link-to" class="headerlink" title="link_to"></a>link_to</h4><p>產生超連結的方法<br>如果加入了remote: true，就會呼叫js，可避免雙重點擊狀況(詳見第4點)</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 link_to 來做超連結</span></span><br><span class="line">&lt;%= link_to <span class="string">&#x27;新增文章&#x27;</span>, new_blog_path, <span class="symbol">remote:</span> <span class="literal">true</span> %&gt;</span><br></pre></td></tr></table></figure>

<p>HTML原始碼</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Rails UJS 加入 data-remote 屬性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/blog/new&quot;</span> <span class="attr">data-remote</span>=<span class="string">&quot;true&quot;</span>&gt;</span>新增文章<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="button-to"><a href="#button-to" class="headerlink" title="button_to"></a>button_to</h3><p>產生按鈕，跟link_to一樣，加入了remote: true，就會呼叫js</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 button_to 來做按鈕</span></span><br><span class="line">&lt;%= button_to <span class="string">&quot;新增文章&quot;</span>, new_blog_path, <span class="symbol">remote:</span> <span class="literal">true</span> %&gt;</span><br></pre></td></tr></table></figure>

<p>HTML原始碼</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Rails UJS 加入 data-remote 、 method 屬性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;blog/new&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button_to&quot;</span> <span class="attr">data-remote</span>=<span class="string">&quot;true&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;新增文章&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="2-data-方法"><a href="#2-data-方法" class="headerlink" title="2. data-方法"></a>2. data-方法</h3><p>HTTP僅支援GET及POST方法<br>其中只有表單可以使用POST方法<br>那編輯、更新、刪除怎麼辦呢？</p>
<p>當我們在屬性中設定method&#x3D;”方法”時<br>Rails UJS會產生_method<br>讓Rails知道你要執行什麼方法<br>是不是超方便的！🥳</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 link_to 來做刪除功能的超連結</span></span><br><span class="line">&lt;%= link_to <span class="string">&#x27;刪除&#x27;</span>, article, <span class="symbol">method:</span> <span class="string">&quot;delete&quot;</span>, <span class="symbol">data:</span> &#123;<span class="symbol">confirm:</span> <span class="string">&quot;are you sure?&quot;</span>&#125;  %&gt;</span><br></pre></td></tr></table></figure>

<p>HTML原始碼</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Rails UJS 加入data-method屬性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">data-confirm</span>=<span class="string">&quot;are you sure?&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;nofollow&quot;</span> <span class="attr">data-method</span>=<span class="string">&quot;delete&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/books/2&quot;</span>&gt;</span>destroy<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="3-用確認來做警告、提示，並執行刪除方法"><a href="#3-用確認來做警告、提示，並執行刪除方法" class="headerlink" title="3. 用確認來做警告、提示，並執行刪除方法"></a>3. 用確認來做警告、提示，並執行刪除方法</h3><p>data-confirm屬性會生出一個警告框<br>在觸發時讓使用者二度確認</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我們在 link_to 中加入 data 及 confirm 讓使用者二度確認</span></span><br><span class="line">&lt;%= link_to <span class="string">&#x27;刪除&#x27;</span>, article, <span class="symbol">method:</span> <span class="string">&quot;delete&quot;</span>, <span class="symbol">data:</span> &#123;<span class="symbol">confirm:</span> <span class="string">&quot;are you sure?&quot;</span>&#125;  %&gt;</span><br></pre></td></tr></table></figure>

<p>確認畫面</p>
<p><img src="https://i.imgur.com/RtmVOEt.png"></p>
<h3 id="4-防止雙點擊"><a href="#4-防止雙點擊" class="headerlink" title="4. 防止雙點擊"></a>4. 防止雙點擊</h3><p>防止使用者雙重點擊，避免HTTP傳送多次request，導致伺服器當機的狀況</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 disable_with 來防止儲存時雙重點擊狀況</span></span><br><span class="line">&lt;%= form_with(<span class="symbol">model:</span> <span class="title class_">User</span>.new) <span class="keyword">do</span> |<span class="params">form</span>| %&gt;</span><br><span class="line">  &lt;%= form.submit <span class="symbol">data:</span> &#123; <span class="symbol">disable_with:</span> <span class="string">&quot;Saving...&quot;</span> &#125; %&gt;</span><br><span class="line">&lt;% <span class="keyword">end</span> %&gt;</span><br></pre></td></tr></table></figure>

<p>HTML原始碼</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Rails UJS 加入了防雙重點擊的屬性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">data-disable-with</span>=<span class="string">&quot;Saving...&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="說了這麼多，Rails-UJS的運作流程是怎麼樣呢？"><a href="#說了這麼多，Rails-UJS的運作流程是怎麼樣呢？" class="headerlink" title="說了這麼多，Rails UJS的運作流程是怎麼樣呢？"></a>說了這麼多，Rails UJS的運作流程是怎麼樣呢？</h3><p>每一小塊流程，可以想像成Rails的callback<br>在AJAX還沒發送HTTP請求前，需要做哪些事<br>發送HTTP請求後，又會做哪些事</p>
<p><img src="https://i.imgur.com/T2pWXRv.jpg"></p>
<h3 id="額外補充：AJAX"><a href="#額外補充：AJAX" class="headerlink" title="額外補充：AJAX"></a>額外補充：AJAX</h3><p>AJAX(Asynchronous JavaScript and XML)<br>是一種非同步的JS及XML機制</p>
<p>早期網頁載入資料時，需要把所有資料先載入到伺服器中，載入完畢才會渲染到畫面中，這樣的做法不僅增加伺服器的負荷，也讓使用者增加了等待時間</p>
<p>AJAX採取需要哪些資料，就先載入哪些資料，並且向HTTP傳送request，這樣的機制不僅減少伺服器的負擔，也讓瀏覽器能快速地回應使用者，減少等待時間</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-08-12</span><i class="fa fa-tag"></i><a class="tag" href="/categories/Rails/" title="Rails">Rails </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,http://ninglab.com/Rails-UJS-Unobtrusive-JavaScript/,NingLab,小機制大效用 一用就回不去的 Rails UJS - Unobtrusive JavaScript,;"></a></div></div><div><script src="https://utteranc.es/client.js" repo="cacachang/cacachang.github.io" issue-term="title" theme="github-light" crossorigin="anonymous" async></script></div><div><script type="text/javascript">document.write("<iframe scrolling='no' frameborder='0' sandbox='allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-storage-access-by-user-activation' style='height: 212px; width: 100%;' src='https://button.like.co/in/embed/a24701770/button?referrer=" + encodeURIComponent(location.href.split("?")[0].split("#")[0]) + "'></iframe>");</script></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/JavaScript-variable-hoisting/" title="幫網頁施點魔法 - JavaScript 變數提升解密">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/Discord-Webhook-bot/" title="Discord Webhook機器人串接">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>